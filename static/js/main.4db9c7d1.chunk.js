(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5452:function(e,t,n){e.exports=n(5657)},5457:function(e,t,n){},5617:function(e,t,n){var r={"./netease.ts":5618,"./qq.ts":5619};function a(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=5617},5618:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return l});var r=n(10),a=n.n(r),i=n(29),o=n(8),s=n(9),c="https://cros.662.workers.dev/",l=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"search",value:function(){var t=Object(i.a)(a.a.mark(function t(n,r,i){var o,s,l,u,h,p,d;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=(r-1)*i,t.next=3,fetch("".concat(c,"https://music.163.com/api/cloudsearch/pc?s=").concat(n,"&type=1&offset=").concat(o,"&limit=").concat(i));case 3:return s=t.sent,t.next=6,s.json();case 6:return l=t.sent,u=l.result,h=u.songCount,p=u.songs,d=p.map(function(t){return{id:t.id,name:t.name,album:{id:t.al.id,name:t.al.name},singer:t.ar.map(function(e){return{id:e.id,name:e.name}}),duration:t.dt,driver:e.title}}),t.abrupt("return",{list:d,total:h});case 11:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(c,"https://music.163.com/api/song/enhance/player/url?ids=[").concat(t,"]&br=320000"));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,i=r.data,e.abrupt("return",i[0].url);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}();l.title="\u7f51\u6613"},5619:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return c});var r=n(10),a=n.n(r),i=n(29),o=n(8),s=n(9),c=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"search",value:function(){var t=Object(i.a)(a.a.mark(function t(n,r,i){var o,s,c,l,u,h,p;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat("https://cros.662.workers.dev/","https://c.y.qq.com/soso/fcgi-bin/client_search_cp?p=").concat(r,"&n=").concat(i,"&w=").concat(n,"&format=json&new_json=1&cr=1"));case 2:return o=t.sent,t.next=5,o.json();case 5:return s=t.sent,c=s.data,l=c.song,u=l.totalnum,h=l.list,p=h.map(function(t){return{id:t.mid,name:t.name,album:{id:t.album.id,name:t.album.name},singer:t.singer.map(function(e){return{id:e.id,name:e.name}}),duration:1e3*t.interval,driver:e.title}}),t.abrupt("return",{list:p,total:u});case 10:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","https://api.bzqll.com/music/tencent/url?key=579621905&id=".concat(t,"&br=320"));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}();c.title="QQ"},5657:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(25),o=n.n(i),s=(n(5457),n(5661)),c=n(5662),l=n(5663),u=n(5660),h=n(17),p=n(30),d=n(8),m=n(9),f=n(27),g=n(26),y=n(28),b=n(3),v=n(11);var O,j,S,k,w,E,x,C,P,D,T,z,I,N,A,M,R,B,_,G,L,U,J,K,W,q,V,F,H,Q,$,X,Y,Z=function(e){var t=e.title,n=e.children;return a.a.createElement(b.s,{title:t,enterDelay:500,leaveDelay:200},n)},ee=n(37).a({basename:"/baiyezi-music"}),te=Object(p.createStyles)({songlistitem:{"& .delete":{display:"none"},"&:hover .delete":{display:"block"}}}),ne=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(){return ee.push("/songlist/".concat(n.props.title))},n.handleDelete=function(){return n.props.onDelete(n.props.title)},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.title,n=e.classes;return a.a.createElement(b.j,{button:!0,onClick:this.handleClick,ContainerProps:{className:n.songlistitem}},a.a.createElement(b.m,{primary:t}),a.a.createElement(b.l,{className:"delete"},a.a.createElement(Z,{title:"\u5220\u9664"},a.a.createElement(b.f,{onClick:this.handleDelete},a.a.createElement(v.e,{fontSize:"small"})))))}}]),t}(a.a.Component),re=Object(p.withStyles)(te)(ne),ae=Object(p.createStyles)({"@keyframes rotate":{from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}},syncing:{animation:"rotate 1s linear 0s infinite"}}),ie=Object(p.withStyles)(ae)(function(e){var t=e.onAdd,n=e.onSync,r=e.syncing,i=e.classes;return a.a.createElement(b.n,null,a.a.createElement("span",null,"\u6211\u7684\u6b4c\u5355"),a.a.createElement(b.l,null,a.a.createElement(Z,{title:"\u540c\u6b65"},a.a.createElement(b.f,{onClick:n,className:r?i.syncing:""},a.a.createElement(v.t,{fontSize:"small"}))),a.a.createElement(Z,{title:"\u65b0\u5efa\u6b4c\u5355"},a.a.createElement(b.f,{onClick:t},a.a.createElement(v.a,{fontSize:"small"})))))}),oe=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).state={value:""},n.done=function(){n.props.onDone(n.state.value),n.props.onHide()},n.handleSubmit=function(e){e.preventDefault(),n.done()},n.handleInputChange=function(e){return n.setState({value:e.target.value})},n.handleDoneClick=function(e){return n.done()},n.handleCancelClick=function(e){return n.props.onHide()},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement(b.j,null,a.a.createElement(b.g,{placeholder:"\u6b4c\u5355\u540d",autoFocus:!0,value:this.state.value,onChange:this.handleInputChange}),a.a.createElement(Z,{title:"\u521b\u5efa"},a.a.createElement(b.f,{onClick:this.handleDoneClick},a.a.createElement(v.f,{fontSize:"small"}))),a.a.createElement(Z,{title:"\u53d6\u6d88"},a.a.createElement(b.f,{onClick:this.handleCancelClick},a.a.createElement(v.b,{fontSize:"small"})))))}}]),t}(a.a.Component),se=Object(h.c)(O=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).state={add:!1},n.handleShowAdd=function(e){return n.setState({add:!0})},n.handleSync=function(e){var t=n.props.githubStore;t.token?t.sync():window.open("/baiyezi-music/oauth/github")},n.handleHideAdd=function(){return n.setState({add:!1})},n.handleAddDone=function(e){return n.props.songlistStore.createSonglist(e)},n.handleDelete=function(e){confirm("\u5220\u9664\u6b4c\u5355\u5c06\u65e0\u6cd5\u6062\u590d\uff01\n\u7ee7\u7eed\uff1f")&&n.props.songlistStore.deleteSonglist(e)},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.songlistStore,r=t.githubStore,i=n.songlists,o=this.state.add;return a.a.createElement(b.i,{subheader:a.a.createElement(ie,{syncing:r.syncing,onAdd:this.handleShowAdd,onSync:this.handleSync}),component:"nav"},o&&a.a.createElement(oe,{onDone:this.handleAddDone,onHide:this.handleHideAdd}),i.map(function(t){return"deleted"!==t.flag&&a.a.createElement(re,{key:t.title,title:t.title,onDelete:e.handleDelete})}))}}]),t}(a.a.Component))||O,ce=Object(h.b)(function(e){return{songlistStore:e.songlistStore,githubStore:e.githubStore}})(se),le=function(){return a.a.createElement(b.i,{component:"nav"},a.a.createElement(b.j,{button:!0,onClick:function(e){return ee.push("/search")}},a.a.createElement(b.k,null,a.a.createElement(v.p,null)),a.a.createElement(b.m,{primary:"\u641c\u7d22\u6b4c\u66f2"})),a.a.createElement(b.j,{button:!0,onClick:function(e){return ee.push("/playlist")}},a.a.createElement(b.k,null,a.a.createElement(v.l,null)),a.a.createElement(b.m,{primary:"\u64ad\u653e\u5217\u8868"})))},ue=Object(p.createStyles)({sider:{},divider:{backgroundColor:"#ddd"}}),he=Object(p.withStyles)(ue)(function(e){var t=e.classes;return a.a.createElement("div",{className:t.sider},a.a.createElement(le,null),a.a.createElement(b.d,{className:t.divider}),a.a.createElement(ce,null))}),pe=n(103),de=function(e){var t=e.value;function n(e){return e<10?"0"+e:e}var r=new Date(t),i=r.getMinutes(),o=r.getSeconds(),s=n(i)+":"+n(o);return a.a.createElement("small",null,s)},me={single:v.n,list:v.m,order:v.i,random:v.q},fe=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).audio=null,n.audioReadied=!1,n.progressTimeout=void 0,n.mounted=!1,n.whoChangedCurrentTime="audio",n.whoChangedPaused="audio",n.progressSliderDragging=!1,n.modes=["single","list","order","random"],n.initAudio=function(){var e=n.audio;e&&(e.currentTime=n.props.currentTime,e.volume=n.props.muted?0:n.props.volume/100)},n.progress=function(){n.props.src&&n.audio&&n.audioReadied&&!n.progressSliderDragging&&(n.props.onCurrentTimeChange(n.audio.currentTime),n.whoChangedCurrentTime="audio"),n.progressTimeout=setTimeout(n.progress,200)},n.handlePausedOrPlayButtonClick=function(){n.props.onPausedChange(!n.props.paused),n.whoChangedPaused="player"},n.handleAudioCanPlayThrough=function(){n.audioReadied=!0,n.mounted&&n.props.onDurationChange(n.audio.duration)},n.handleAudioPlay=function(){n.props.onPausedChange(!1),n.whoChangedPaused="audio"},n.handleAudioEnd=function(){n.props.onPlayNext(),n.props.onPausedChange(!0),n.whoChangedPaused="audio"},n.handleDurationSliderChange=function(e,t){n.props.onCurrentTimeChange(t),n.whoChangedCurrentTime="player"},n.handleDurationSliderDragStart=function(){n.progressSliderDragging=!0},n.handleDurationSliderDragEnd=function(){n.progressSliderDragging=!1,n.audio.currentTime=n.props.currentTime},n.handleNextButtonClick=function(){n.props.onPlayNext(),n.whoChangedCurrentTime="player"},n.handlePrevButtonClick=function(){n.props.onPlayPrev(),n.whoChangedCurrentTime="player"},n.handleModeButtonClick=function(){var e=n.modes.indexOf(n.props.mode),t=e===n.modes.length-1?0:e+1,r=n.modes[t];n.props.onModeChange(r)},n.handleVolumeSliderChange=function(e,t){n.props.onVolumeChange(t)},n.handleMutedButtionClick=function(){n.props.onMutedChange(!n.props.muted)},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,this.initAudio(),this.progress()}},{key:"componentWillUnmount",value:function(){this.progressTimeout&&clearInterval(this.progressTimeout)}},{key:"componentDidUpdate",value:function(e,t,n){var r=this.audio,a=this.props;r&&(a.muted!==e.muted&&(r.volume=a.muted?0:a.volume/100),a.paused!==e.paused&&"player"===this.whoChangedPaused&&(a.paused?r.pause():r.play()),a.volume!==e.volume&&(r.volume=a.volume/100),a.currentTime===e.currentTime||"player"!==this.whoChangedCurrentTime||this.progressSliderDragging||(r.currentTime=a.currentTime),this.whoChangedPaused="audio",this.whoChangedCurrentTime="audio")}},{key:"render",value:function(){var e=this,t=this.props.classes,n=this.props,r=n.paused,i=n.muted,o=n.volume,s=n.duration,c=n.currentTime,l=n.mode,u=this.props,h=u.src,p=u.song,d=u.singer,m=me[l];return a.a.createElement("div",{className:t.wrapper},a.a.createElement("div",{className:t.audioWrapper},h&&a.a.createElement("audio",{controls:!0,autoPlay:!0,ref:function(t){return e.audio=t},className:t.audio,src:h,onPlay:this.handleAudioPlay,onEnded:this.handleAudioEnd,onCanPlayThrough:this.handleAudioCanPlayThrough},"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 video \u6807\u7b7e\u3002")),a.a.createElement("div",{className:t.player},a.a.createElement("div",{className:t.mainControl},a.a.createElement(b.f,{onClick:this.handlePrevButtonClick},a.a.createElement(v.s,{fontSize:"large"})),a.a.createElement(b.f,{onClick:this.handlePausedOrPlayButtonClick},r?a.a.createElement(v.k,{fontSize:"large"}):a.a.createElement(v.j,{fontSize:"large"})),a.a.createElement(b.f,{onClick:this.handleNextButtonClick},a.a.createElement(v.r,{fontSize:"large"}))),a.a.createElement("div",{className:t.info},a.a.createElement("div",{className:t.mainSliderTitle},a.a.createElement("div",null,p," - ",d),a.a.createElement("div",null,a.a.createElement(de,{value:1e3*c})," /",a.a.createElement(de,{value:1e3*s}))),a.a.createElement("div",{className:t.mainSliderWrapper},a.a.createElement(pe.a,{min:0,max:s,value:c,onChange:this.handleDurationSliderChange,onDragStart:this.handleDurationSliderDragStart,onDragEnd:this.handleDurationSliderDragEnd}))),a.a.createElement("div",null,a.a.createElement(b.f,null,a.a.createElement(v.o,null)),a.a.createElement(b.f,{onClick:this.handleModeButtonClick},a.a.createElement(m,null))),a.a.createElement("div",{className:t.secondaryControl},a.a.createElement(b.f,{onClick:this.handleMutedButtionClick},i?a.a.createElement(v.u,null):a.a.createElement(v.v,null)),a.a.createElement("div",{className:t.volumeSlider},a.a.createElement(pe.a,{min:0,max:100,value:o,onChange:this.handleVolumeSliderChange})))))}}]),t}(a.a.Component),ge=function(e){return Object(p.createStyles)({wrapper:{width:"100%",backgroundColor:"#fafafa",boxShadow:"0px 0px 4px #ddd"},audioWrapper:{display:"none"},player:{display:"flex",alignItems:"center",padding:"4px 16px"},audio:{width:"100%",height:"48px",backgroundColor:"rgb(241,243,244)"},mainControl:{},info:{padding:"16px",flex:1},secondaryControl:{display:"flex",alignItems:"center"},volumeSlider:{width:"100px"},mainSliderTitle:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"12px"},mainSliderWrapper:{flex:1}})},ye=Object(p.withStyles)(ge)(fe),be=Object(h.c)(ye),ve=Object(h.b)(function(e){var t=e.playerStore;return{src:t.src,song:t.currentSong?t.currentSong.name:"",singer:t.currentSong?t.currentSong.singer.map(function(e){return e.name}).join("&"):"",paused:t.paused,muted:t.muted,volume:t.volume,duration:t.duration,currentTime:t.currentTime,mode:t.mode,onPlayPrev:t.playPrev.bind(t),onPlayNext:t.playNext.bind(t),onModeChange:t.changeMode.bind(t),onPausedChange:t.changePaused.bind(t),onMutedChange:t.changeMuted.bind(t),onVolumeChange:t.changeVolume.bind(t),onDurationChange:t.changeDuration.bind(t),onCurrentTimeChange:t.changeCurrentTime.bind(t)}})(be),Oe=Object(p.withStyles)(function(e){return Object(p.createStyles)({songDetail:{"& b":{fontWeight:"normal"},"& i,& small":{marginLeft:"8px"}}})})(Object(h.c)(function(e){var t=e.song,n=e.classes;return a.a.createElement(b.t,{variant:"inherit",noWrap:!0,className:n.songDetail},a.a.createElement("b",null,t.singer.map(function(e){return e.name}).join("&")),a.a.createElement(de,{value:t.duration}),t.album.name&&a.a.createElement("i",{title:"\u300a".concat(t.album.name,"\u300b")},"\u300a",t.album.name,"\u300b"))})),je=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).state={menu:!1},n.anchorEl=null,n.handleAdd=function(e){return n.setState({menu:!0})},n.handleCloseMenu=function(){return n.setState({menu:!1})},n.handlePlay=function(e){var t=n.props;(0,t.onPlay)(t.song)},n.handleAddToPlaylist=function(e){var t=n.props;(0,t.onAddToPlaylist)(t.song),n.handleCloseMenu()},n.handleAddToSonglist=function(e){var t=n.props;(0,t.onAddToSonglist)(e,t.song),n.handleCloseMenu()},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.song,r=t.classes,i=t.songlists,o=t.extendAction,s=t.showPlaylistOnMenu,c=t.hideDriver,l=this.state.menu;return a.a.createElement(b.j,{ContainerProps:{className:r.listitem}},a.a.createElement(b.k,null,a.a.createElement(Z,{title:"\u64ad\u653e"},a.a.createElement(b.e,{size:"small",onClick:this.handlePlay},a.a.createElement(v.k,null)))),a.a.createElement(b.m,{primary:a.a.createElement(b.t,{variant:"inherit",noWrap:!0},n.name,!c&&a.a.createElement("small",{className:r.driver},"[",n.driver,"]")),secondary:a.a.createElement(Oe,{song:n})}),a.a.createElement(b.l,null,a.a.createElement(b.f,{buttonRef:function(t){return e.anchorEl=t},onClick:this.handleAdd},a.a.createElement(v.a,{fontSize:"small"})),a.a.createElement(b.o,{open:l,anchorEl:this.anchorEl,onClose:this.handleCloseMenu},s&&a.a.createElement(b.p,{onClick:this.handleAddToPlaylist},"\u64ad\u653e\u5217\u8868"),s&&a.a.createElement(b.d,null),i.map(function(t){return a.a.createElement(b.p,{key:t.title,onClick:function(n){return e.handleAddToSonglist(t.title)}},t.title)})),o))}}]),t}(a.a.Component),Se=Object(p.withStyles)(function(e){return Object(p.createStyles)({listitem:{cursor:"default",borderBottom:"dashed 1px #ddd"},driver:{marginLeft:"8px",color:"#999",fontSize:"12px"}})})(je),ke=n(13),we=n.n(ke),Ee=n(55),xe={success:v.c,warning:v.w,error:v.g,info:v.h},Ce=Object(p.withStyles)(function(e){return Object(p.createStyles)({success:{backgroundColor:Ee.green[600]},error:{backgroundColor:e.palette.error.dark},info:{backgroundColor:e.palette.primary.dark},warning:{backgroundColor:Ee.amber[700]},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing.unit},message:{display:"flex",alignItems:"center"}})})(function(e){var t=e.key,n=e.open,r=e.message,i=e.onClose,o=e.variant,s=e.classes,c=e.onExited,l=xe[o];return a.a.createElement(b.q,{key:t,ContentProps:{className:s[o]},anchorOrigin:{vertical:"top",horizontal:"right"},open:n,autoHideDuration:3e3,onClose:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){"clickaway"!==t&&i()}),onExited:c,message:a.a.createElement("span",{className:s.message},a.a.createElement(l,{className:we()(s.icon,s.iconVariant)}),r),action:[a.a.createElement(b.f,{key:"close","aria-label":"Close",color:"inherit",onClick:i},a.a.createElement(v.d,{className:s.icon}))]})}),Pe=Object(h.b)(function(e){var t=e.playlistStore,n=e.songlistStore,r=e.snackbarStore;return{showPlaylistOnMenu:!0,songlists:n.songlists,onPlay:function(e){t.add(e,!0),r.success("\u300a".concat(e.name,"\u300b\u5df2\u6dfb\u52a0\u5230 {\u64ad\u653e\u5217\u8868}"))},onAddToPlaylist:function(e){t.add(e),r.success("\u300a".concat(e.name,"\u300b\u5df2\u6dfb\u52a0\u5230 {\u64ad\u653e\u5217\u8868}"))},onAddToSonglist:function(e,t){n.pushSonglist(e,t),r.success("\u300a".concat(t.name,"\u300b\u5df2\u6dfb\u52a0\u5230 {").concat(e,"}"))}}})(Se),De=Object(h.b)(function(e){var t=e.playlistStore,n=e.songlistStore,r=e.snackbarStore;return{showPlaylistOnMenu:!1,songlists:n.songlists,onPlay:function(e){t.add(e,!0)},onAddToPlaylist:function(e){t.add(e),r.success("\u300a".concat(e.name,"\u300b\u5df2\u6dfb\u52a0\u5230 {\u64ad\u653e\u5217\u8868}"))},onAddToSonglist:function(e,t){n.pushSonglist(e,t),r.success("\u300a".concat(t.name,"\u300b\u5df2\u6dfb\u52a0\u5230 {").concat(e,"}"))}}})(Se),Te=Object(h.c)(Ce),ze=Object(h.b)(function(e){var t=e.snackbarStore;return{key:t.key,open:t.open,variant:t.variant,message:t.message,onClose:function(){return t.close()},onExited:function(){return t.show()}}})(Te),Ie=function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.classes;return a.a.createElement("div",{className:n.wrapper},a.a.createElement(b.c,null),a.a.createElement("div",{className:n.main},a.a.createElement("div",{className:n.sidebar},a.a.createElement(he,null)),a.a.createElement("div",{className:n.content},t)),a.a.createElement("div",{className:n.player},a.a.createElement(ve,null)),a.a.createElement(ze,null))}}]),t}(a.a.Component),Ne=Object(p.withStyles)(function(e){return Object(p.createStyles)({wrapper:{minWidth:"960px"},main:{display:"flex"},sidebar:{position:"fixed",width:"240px",height:"calc(100vh - 67px)",borderRight:"solid 1px #ddd",zIndex:999},content:{width:"100%",padding:"24px 24px 0 24px",marginLeft:"240px",marginBottom:"48px"},player:{position:"fixed",bottom:0,left:0,width:"100%",minWidth:"960px"}})})(Ie),Ae=Object(p.createStyles)({search:{padding:"8px 0 8px 0",textAlign:"center"},input:{width:"666px"}}),Me=Object(h.c)(j=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).handleSubmit=function(e){e.preventDefault(),n.props.onSubmit()},n.handleChange=function(e){n.props.onChange(e.target.value)},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.classes;return a.a.createElement("div",{className:n.search},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement(b.r,{InputProps:{startAdornment:a.a.createElement(b.h,{position:"start"},a.a.createElement(v.p,null))},className:n.input,label:"\u6b4c\u540d/\u6b4c\u624b",autoFocus:!0,value:t,onChange:this.handleChange,variant:"outlined"})))}}]),t}(r.Component))||j,Re=Object(h.b)(function(e){var t=e.searchStore;return{value:t.keywords,onSubmit:t.search.bind(t),onChange:t.setKeyowrds.bind(t)}})(Object(p.withStyles)(Ae)(Me)),Be=function(e){var t=e.songs;return a.a.createElement(b.i,null,t.map(function(e){return a.a.createElement(Pe,{hideDriver:!0,key:e.id+e.driver,song:e})}))},_e=Object(p.createStyles)({resultItem:{marginRight:"24px",width:"50%"},header:{padding:"0 16px"}}),Ge=Object(h.c)(function(e){var t=e.result,n=e.classes;return a.a.createElement("div",{className:n.resultItem},a.a.createElement("div",{className:n.header},a.a.createElement("h2",null,t.title)),t.searching&&a.a.createElement(b.b,null),a.a.createElement(Be,{songs:t.songs}))}),Le=Object(p.withStyles)(_e)(Ge),Ue=Object(h.c)(function(e){var t=e.results,n=e.classes;return a.a.createElement("div",{className:n.resultList},t.map(function(e){return a.a.createElement(Le,{key:e.title,result:e})}))}),Je=Object(p.withStyles)(function(e){return Object(p.createStyles)({resultList:{display:"flex"}})})(Ue),Ke=Object(h.b)(function(e){return{results:e.searchStore.result}})(Je),We=function(){return a.a.createElement("div",null,a.a.createElement(Re,null),a.a.createElement(Ke,null))},qe=n(5659),Ve=Object(p.withStyles)(function(e){return Object(p.createStyles)({header:{marginBottom:"16px",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},title:{fontSize:"24px"},actions:{display:"flex","&>*":{marginRight:"8px"}}})})(function(e){var t=e.title,n=e.children,r=e.classes,i=e.actions;return a.a.createElement("div",null,a.a.createElement("div",{className:r.header},a.a.createElement("div",{className:r.title},t),a.a.createElement("div",{className:r.actions},i)),a.a.createElement("div",null,n))}),Fe=Object(h.c)(S=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(a)))).getSonglistTitle=function(){return n.props.match.params.title},n.getSonglist=function(){var e=n.props.songlists,t=n.getSonglistTitle();return e.find(function(e){return e.title===t})},n.handlePlayAllClick=function(){var e=n.getSonglistTitle(),t=n.getSonglist();n.props.onPlayAll(t.items,e)},n.handleAddToPlaylistClick=function(){var e=n.getSonglistTitle(),t=n.getSonglist();n.props.onAddToPlaylist(t.items,e)},n}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.onRemove,t=this.getSonglist();return a.a.createElement(Ve,{title:t.title,actions:[a.a.createElement(b.a,{key:"playAll",variant:"contained",size:"small",onClick:this.handlePlayAllClick},a.a.createElement(v.k,{fontSize:"small"}),"\u5168\u90e8\u64ad\u653e"),a.a.createElement(b.a,{key:"addToPlaylist",variant:"contained",size:"small",onClick:this.handleAddToPlaylistClick},a.a.createElement(v.a,{fontSize:"small"}),"\u52a0\u5165\u64ad\u653e\u5217\u8868")]},0===t.items.length?a.a.createElement("div",null,"\u6682\u65e0\u6b4c\u66f2\uff0c\u53bb",a.a.createElement(qe.a,{to:"/search"},"\u6dfb\u52a0")):a.a.createElement(b.i,null,t.items.map(function(n){return"deleted"!==n.flag&&a.a.createElement(Pe,{key:n.id+n.driver,song:n,extendAction:a.a.createElement(b.f,{onClick:function(r){return e(t.title,n.driver,n.id)}},a.a.createElement(v.e,{fontSize:"small"}))})})))}}]),t}(a.a.Component))||S,He=Object(h.b)(function(e){var t=e.songlistStore,n=e.playlistStore,r=e.snackbarStore;return{songlists:t.songlists,onPlayAll:function(e,t){n.append(e,!0),r.success("".concat(t," \u5df2\u6dfb\u52a0\u5230 {\u64ad\u653e\u5217\u8868}"))},onAddToPlaylist:function(e,t){n.append(e,!1),r.success("".concat(t," \u5df2\u6dfb\u52a0\u5230 {\u64ad\u653e\u5217\u8868}"))},onRemove:function(e,n,r){return t.popSonglist(e,n,r)}}})(Fe),Qe=Object(h.c)(k=function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.songs,n=e.onRemove,r=e.onClear;return a.a.createElement(Ve,{title:"\u64ad\u653e\u5217\u8868",actions:a.a.createElement(b.a,{variant:"contained",size:"small",onClick:r},a.a.createElement(v.e,{fontSize:"small"}),"\u6e05\u7a7a")},0===t.length?a.a.createElement("div",null,"\u6682\u65e0\u6b4c\u66f2\uff0c\u53bb",a.a.createElement(qe.a,{to:"/search"},"\u6dfb\u52a0")):a.a.createElement(b.i,null,t.map(function(e,t){return a.a.createElement(De,{key:e.id+e.driver,song:e,extendAction:a.a.createElement(b.f,{onClick:function(e){return n(t)}},a.a.createElement(v.e,{fontSize:"small"}))})})))}}]),t}(a.a.Component))||k,$e=Object(h.b)(function(e){var t=e.playlistStore;return{songs:t.availableSongs,onClear:function(){return t.clear()},onRemove:function(e){return t.remove(e)}}})(Qe),Xe=n(47),Ye=n.n(Xe),Ze=function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,n=(e.history,e.authorizeURL),r=e.getAccessToken,a=t.search,i=Ye.a.parse(a).code;i?r(i).then(function(e){window.opener&&(window.opener.baiyezi_music_store.githubStore.oauthSuccess(e),window.close())}):window.location.replace(n)}},{key:"render",value:function(){return a.a.createElement("div",{style:{textAlign:"center",marginTop:100}},a.a.createElement(b.b,null))}}]),t}(a.a.Component),et=Object(h.b)(function(e){var t=e.githubStore;return{authorizeURL:t.authorizeURL,getAccessToken:t.getAccessToken.bind(t)}})(Ze),tt=n(10),nt=n.n(tt),rt=n(23),at=n(7),it=(n(46),n(4)),ot=(w=function e(){Object(d.a)(this,e),Object(rt.a)(this,"searching",E,this),Object(rt.a)(this,"title",x,this),Object(rt.a)(this,"total",C,this),Object(rt.a)(this,"songs",P,this)},E=Object(at.a)(w.prototype,"searching",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),x=Object(at.a)(w.prototype,"title",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C=Object(at.a)(w.prototype,"total",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P=Object(at.a)(w.prototype,"songs",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),w),st=(D=function(){function e(t){Object(d.a)(this,e),this.root=void 0,Object(rt.a)(this,"keywords",T,this),Object(rt.a)(this,"result",z,this),this.runDriver=Object(it.h)(nt.a.mark(function e(t){var n,r,a,i;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new ot).title=t.title,this.result.push(n),e.next=5,t.instance.search(this.keywords,1,20);case 5:r=e.sent,a=r.total,i=r.list,n.total=a,n.songs=i,n.searching=!1;case 11:case"end":return e.stop()}},e,this)})),this.root=t}return Object(m.a)(e,[{key:"setKeyowrds",value:function(e){this.keywords=e}},{key:"search",value:function(){var e=this;this.result=[],this.root.driverStore.drivers.forEach(function(t){return e.runDriver(t)})}}]),e}(),T=Object(at.a)(D.prototype,"keywords",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"\u96ea\u843d\u4e0b\u7684\u58f0\u97f3"}}),z=Object(at.a)(D.prototype,"result",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(at.a)(D.prototype,"setKeyowrds",[it.d],Object.getOwnPropertyDescriptor(D.prototype,"setKeyowrds"),D.prototype),Object(at.a)(D.prototype,"search",[it.d],Object.getOwnPropertyDescriptor(D.prototype,"search"),D.prototype),D),ct=function(){function e(t){Object(d.a)(this,e),this.root=void 0,this.drivers=[],this.root=t,this.scanDrivers()}return Object(m.a)(e,[{key:"scanDrivers",value:function(){var e=n(5617),t=e.keys().map(function(t){var n=e(t).default;return{title:n.title,instance:new n}});this.drivers=t}}]),e}(),lt=(I=function(){function e(t){var n=this;Object(d.a)(this,e),this.root=void 0,Object(rt.a)(this,"songs",N,this),this.storageKey="baiyezi-playlist",this.root=t,this.load(),Object(it.e)(function(){return n.save()})}return Object(m.a)(e,[{key:"availableSongs",get:function(){return this.songs.filter(function(e){return"deleted"!==e.flag})}}]),Object(m.a)(e,[{key:"save",value:function(){var e=JSON.stringify(this.songs);localStorage.setItem(this.storageKey,e)}},{key:"load",value:function(){var e=localStorage.getItem(this.storageKey)||"[]",t=JSON.parse(e);this.songs=t||this.songs}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.songs.findIndex(function(t){return t.id===e.id&&t.driver===e.driver}),r=n;-1===n&&(e.flag="created",this.songs.push(e),r=this.songs.length-1),t&&(this.root.playerStore.playlistIndex=r)}},{key:"append",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;n<e.length;n++)0===n&&t?this.add(e[n],!0):this.add(e[n])}},{key:"clear",value:function(){this.songs.forEach(function(e){return e.flag="deleted"}),this.root.playerStore.src="",this.root.playerStore.playlistIndex=0}},{key:"remove",value:function(e){this.songs[e].flag="deleted",e===this.root.playerStore.playlistIndex?this.root.playerStore.fetchSrc():e<this.root.playerStore.playlistIndex&&this.root.playerStore.playlistIndex--}}]),e}(),N=Object(at.a)(I.prototype,"songs",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(at.a)(I.prototype,"add",[it.d],Object.getOwnPropertyDescriptor(I.prototype,"add"),I.prototype),Object(at.a)(I.prototype,"append",[it.d],Object.getOwnPropertyDescriptor(I.prototype,"append"),I.prototype),Object(at.a)(I.prototype,"clear",[it.d],Object.getOwnPropertyDescriptor(I.prototype,"clear"),I.prototype),Object(at.a)(I.prototype,"remove",[it.d],Object.getOwnPropertyDescriptor(I.prototype,"remove"),I.prototype),I),ut=(A=function(){function e(t){var n=this;Object(d.a)(this,e),this.root=void 0,Object(rt.a)(this,"songlists",M,this),this.songlistsStorageKey="baiyezi-songlists",this.root=t;var r=localStorage.getItem(this.songlistsStorageKey)||"[]";this.songlists=JSON.parse(r),Object(it.e)(function(){var e=JSON.stringify(n.songlists);localStorage.setItem(n.songlistsStorageKey,e)})}return Object(m.a)(e,[{key:"createSonglist",value:function(e){if(e){if(this.songlists.some(function(t){return t.title===e}))throw new Error("\u6b4c\u5355\u540d\u5df2\u5b58\u5728");this.songlists.push({title:e,items:[],flag:"created"})}}},{key:"renameSonglist",value:function(e,t){var n=this.songlists.find(function(t){return t.title===e});n.title=t,n.flag="created",this.songlists.push({flag:"deleted",title:e,items:[]})}},{key:"deleteSonglist",value:function(e){this.songlists.find(function(t){return t.title===e}).flag="deleted"}},{key:"pushSonglist",value:function(e,t){var n=this.songlists.find(function(t){return t.title===e});-1===n.items.findIndex(function(e){return e.id===t.id&&e.driver==t.driver})&&(t.flag="created",n.items.push(t))}},{key:"popSonglist",value:function(e,t,n){this.songlists.find(function(t){return t.title===e}).items.find(function(e){return e.driver===t&&e.id===n}).flag="deleted"}}]),e}(),M=Object(at.a)(A.prototype,"songlists",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(at.a)(A.prototype,"createSonglist",[it.d],Object.getOwnPropertyDescriptor(A.prototype,"createSonglist"),A.prototype),Object(at.a)(A.prototype,"renameSonglist",[it.d],Object.getOwnPropertyDescriptor(A.prototype,"renameSonglist"),A.prototype),Object(at.a)(A.prototype,"deleteSonglist",[it.d],Object.getOwnPropertyDescriptor(A.prototype,"deleteSonglist"),A.prototype),Object(at.a)(A.prototype,"pushSonglist",[it.d],Object.getOwnPropertyDescriptor(A.prototype,"pushSonglist"),A.prototype),Object(at.a)(A.prototype,"popSonglist",[it.d],Object.getOwnPropertyDescriptor(A.prototype,"popSonglist"),A.prototype),A),ht=(R=function(){function e(t){Object(d.a)(this,e),this.root=void 0,Object(rt.a)(this,"key",B,this),Object(rt.a)(this,"open",_,this),Object(rt.a)(this,"message",G,this),Object(rt.a)(this,"variant",L,this),this.queue=[],this.root=t}return Object(m.a)(e,[{key:"close",value:function(){this.open=!1}},{key:"push",value:function(e,t){this.queue.push({message:e,variant:t,key:(new Date).valueOf()}),this.open?this.open=!1:this.show()}},{key:"show",value:function(){if(this.queue.length>0){var e=this.queue.shift();this.message=e.message,this.variant=e.variant,this.open=!0}}},{key:"success",value:function(e){this.push(e,"success")}},{key:"warning",value:function(e){this.push(e,"warning")}},{key:"error",value:function(e){this.push(e,"error")}},{key:"info",value:function(e){this.push(e,"info")}}]),e}(),B=Object(at.a)(R.prototype,"key",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(new Date).valueOf()}}),_=Object(at.a)(R.prototype,"open",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),G=Object(at.a)(R.prototype,"message",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),L=Object(at.a)(R.prototype,"variant",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"info"}}),Object(at.a)(R.prototype,"close",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"close"),R.prototype),Object(at.a)(R.prototype,"push",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"push"),R.prototype),Object(at.a)(R.prototype,"show",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"show"),R.prototype),Object(at.a)(R.prototype,"success",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"success"),R.prototype),Object(at.a)(R.prototype,"warning",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"warning"),R.prototype),Object(at.a)(R.prototype,"error",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"error"),R.prototype),Object(at.a)(R.prototype,"info",[it.d],Object.getOwnPropertyDescriptor(R.prototype,"info"),R.prototype),R),pt=(U=function(){function e(t){var n=this;Object(d.a)(this,e),this.root=void 0,this.storageKey="baiyezi-player",Object(rt.a)(this,"mode",J,this),Object(rt.a)(this,"paused",K,this),Object(rt.a)(this,"muted",W,this),Object(rt.a)(this,"volume",q,this),Object(rt.a)(this,"duration",V,this),Object(rt.a)(this,"currentTime",F,this),Object(rt.a)(this,"src",H,this),Object(rt.a)(this,"playlistIndex",Q,this),this.fetchSrc=Object(it.h)(nt.a.mark(function e(){var t,n,r=this;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.currentSong){e.next=8;break}return t=this.root.driverStore.drivers.find(function(e){return e.title===r.currentSong.driver}),e.next=4,t.instance.find(this.currentSong.id);case 4:n=e.sent,this.src=n,e.next=9;break;case 8:this.src="";case 9:case"end":return e.stop()}},e,this)})),this.root=t,this.load(),Object(it.e)(function(){return n.save()}),Object(it.n)(this,"playlistIndex",function(e){return n.fetchSrc()}),this.playlist.length>this.playlistIndex?this.fetchSrc():(this.currentTime=0,this.duration=0,this.playlistIndex=0,this.src="")}return Object(m.a)(e,[{key:"playlist",get:function(){return this.root.playlistStore.availableSongs}},{key:"currentSong",get:function(){return this.playlist[this.playlistIndex]}}]),Object(m.a)(e,[{key:"save",value:function(){var e=JSON.stringify({muted:this.muted,volume:this.volume,duration:this.duration,currentTime:this.currentTime,mode:this.mode,src:this.src,playlistIndex:this.playlistIndex});localStorage.setItem(this.storageKey,e)}},{key:"load",value:function(){var e=localStorage.getItem(this.storageKey)||"{}",t=JSON.parse(e);this.muted=t.muted||this.muted,this.volume=t.volume||this.volume,this.duration=t.duration||this.duration,this.currentTime=t.currentTime||this.currentTime,this.mode=t.mode||this.mode,this.playlistIndex=t.playlistIndex||this.playlistIndex,this.src=t.src||this.src}},{key:"changePaused",value:function(e){this.paused=e}},{key:"changeMuted",value:function(e){this.muted=e}},{key:"changeVolume",value:function(e){this.volume=e,this.muted=0===e}},{key:"changeMode",value:function(e){this.mode=e}},{key:"changeDuration",value:function(e){this.duration=e}},{key:"changeCurrentTime",value:function(e){this.currentTime=e}},{key:"playNext",value:function(){var e=this.playlist.length;switch(this.mode){case"single":this.src+=" ";break;case"list":this.playlistIndex=this.playlistIndex<e-1?this.playlistIndex+1:0;break;case"order":this.playlistIndex<e-1&&(this.playlistIndex=this.playlistIndex+1);break;case"random":this.playlistIndex=Math.round(Math.random()*(e-1))}}},{key:"playPrev",value:function(){var e=this.playlist.length;switch(this.mode){case"single":this.src+=" ";break;case"list":this.playlistIndex=this.playlistIndex>0?this.playlistIndex-1:e-1;break;case"order":this.playlistIndex>0&&(this.playlistIndex=this.playlistIndex-1);break;case"random":this.playlistIndex=Math.round(Math.random()*(e-1))}}}]),e}(),J=Object(at.a)(U.prototype,"mode",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"list"}}),K=Object(at.a)(U.prototype,"paused",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),W=Object(at.a)(U.prototype,"muted",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q=Object(at.a)(U.prototype,"volume",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),V=Object(at.a)(U.prototype,"duration",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F=Object(at.a)(U.prototype,"currentTime",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H=Object(at.a)(U.prototype,"src",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Q=Object(at.a)(U.prototype,"playlistIndex",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(at.a)(U.prototype,"changePaused",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"changePaused"),U.prototype),Object(at.a)(U.prototype,"changeMuted",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"changeMuted"),U.prototype),Object(at.a)(U.prototype,"changeVolume",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"changeVolume"),U.prototype),Object(at.a)(U.prototype,"changeMode",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"changeMode"),U.prototype),Object(at.a)(U.prototype,"changeDuration",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"changeDuration"),U.prototype),Object(at.a)(U.prototype,"changeCurrentTime",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"changeCurrentTime"),U.prototype),Object(at.a)(U.prototype,"playNext",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"playNext"),U.prototype),Object(at.a)(U.prototype,"playPrev",[it.d],Object.getOwnPropertyDescriptor(U.prototype,"playPrev"),U.prototype),U),dt=n(29),mt=function(){function e(t,n,r,a){Object(d.a)(this,e),this.clientID=void 0,this.clientSecret=void 0,this.redirectURL=void 0,this.scope=void 0,this.url={authorize:"https://github.com/login/oauth/authorize",access_token:"https://github.com/login/oauth/access_token",cross_origin:"https://cros.662.workers.dev"},this.clientID=t,this.clientSecret=n,this.redirectURL=r,this.scope=a}return Object(m.a)(e,[{key:"getAuthorizeURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Ye.a.stringify({client_id:this.clientID,scope:this.scope,state:e});return"".concat(this.url.authorize,"?").concat(t)}},{key:"getAccessTokenURL",value:function(e){var t={client_id:this.clientID,client_secret:this.clientSecret,code:e},n=Ye.a.stringify(t);return"".concat(this.url.cross_origin,"/").concat(this.url.access_token,"?").concat(n)}},{key:"getAccessToken",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t){var n,r,a,i,o;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getAccessTokenURL(t),e.next=3,fetch(n);case 3:return r=e.sent,e.next=6,r.text();case 6:return a=e.sent,i=Ye.a.parse(a),o=i.access_token,e.abrupt("return",o);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),ft=n(187),gt=n.n(ft),yt=function(){function e(t){Object(d.a)(this,e),this.github=void 0,this.github=t}return Object(m.a)(e,[{key:"createGist",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t,n){var r,a;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.github.getGist().create({public:!1,description:t,files:n});case 2:return r=e.sent,a=r.data,e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateGistFiles",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t,n){var r;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.github.getGist(t),e.next=3,r.update({files:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMyGistByDescription",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t){var n,r,a;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.github.getUser().listGists();case 2:return n=e.sent,r=n.data||[],a=r.find(function(e){return e.description===t}),e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findGistById",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t){var n,r;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.github.getGist(t).read();case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),bt=function(){function e(t){Object(d.a)(this,e),this.helper=void 0,this.github=void 0,this.storeName="baiyezi-music",this.storeGistID=void 0,this.github=new gt.a({token:t}),this.helper=new yt(this.github)}return Object(m.a)(e,[{key:"createStore",value:function(){var e=Object(dt.a)(nt.a.mark(function e(){return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.helper.createGist(this.storeName,{"playlist.json":{content:"[]"},"songlist.json":{content:"[]"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getStore",value:function(){var e=Object(dt.a)(nt.a.mark(function e(){var t;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.helper){e.next=2;break}throw new Error("\u5c1a\u672a\u83b7\u5f97github\u6388\u6743");case 2:if(t=null,!this.storeGistID){e.next=9;break}return e.next=6,this.helper.findGistById(this.storeGistID);case 6:t=e.sent,e.next=21;break;case 9:return e.next=11,this.helper.findMyGistByDescription("baiyezi-music");case 11:if(!(t=e.sent)){e.next=18;break}return e.next=15,this.helper.findGistById(t.id);case 15:t=e.sent,e.next=21;break;case 18:return e.next=20,this.createStore();case 20:t=e.sent;case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"syncPlaylist",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t){var n,r,a;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStore();case 2:return n=e.sent,r=JSON.parse(n.files["playlist.json"].content),a=this.mergeSongs(t,r),e.next=7,this.helper.updateGistFiles(n.id,{"playlist.json":{content:JSON.stringify(a,null,4)}});case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"syncSonglist",value:function(){var e=Object(dt.a)(nt.a.mark(function e(t){var n,r,a;return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStore();case 2:return n=e.sent,r=JSON.parse(n.files["songlist.json"].content),a=this.mergeSonglists(t,r),e.next=7,this.helper.updateGistFiles(n.id,{"songlist.json":{content:JSON.stringify(a,null,4)}});case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mergeSonglists",value:function(e,t){var n=this,r=this.merge(e,t,function(e){return function(t){return e.title===t.title}});return r.forEach(function(e){var r=t.find(function(t){return t.title===e.title});r&&(e.items=n.merge(e.items,r.items,function(e){return function(t){return e.id===t.id&&e.driver===t.driver}}))}),r}},{key:"mergeSongs",value:function(e,t){return this.merge(e,t,function(e){return function(t){return e.id===t.id&&e.driver===t.driver}})}},{key:"merge",value:function(e,t,n){var r=JSON.parse(JSON.stringify(e));t.forEach(function(e){r.some(n(e))||r.push(e)});var a=[];return r.forEach(function(e,r){t.some(n(e))?"deleted"===e.flag&&a.push(r):"created"!==e.flag&&a.push(r),delete e.flag}),a.forEach(function(e){return r.splice(e,1)}),r}}]),e}(),vt=($=function(){function e(t){var n=this;Object(d.a)(this,e),this.root=void 0,this.oauth=void 0,this.authorizeURL=void 0,this.githubSync=void 0,Object(rt.a)(this,"token",X,this),Object(rt.a)(this,"syncing",Y,this),this.sync=Object(it.h)(nt.a.mark(function e(){return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncing=!0,e.next=3,this.githubSync.syncPlaylist(this.root.playlistStore.songs);case 3:return this.root.playlistStore.songs=e.sent,e.next=6,this.githubSync.syncSonglist(this.root.songlistStore.songlists);case 6:this.root.songlistStore.songlists=e.sent,this.syncing=!1;case 8:case"end":return e.stop()}},e,this)})),this.getAccessToken=Object(it.h)(nt.a.mark(function e(t){return nt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.oauth.getAccessToken(t);case 2:return this.token=e.sent,e.abrupt("return",this.token);case 4:case"end":return e.stop()}},e,this)})),this.root=t,this.oauth=new mt("8353b545fe018f2066ef","838e759c5f223e2604e0ae3126b6f6eec48843a9","/","user gist"),this.authorizeURL=this.oauth.getAuthorizeURL();var r=localStorage.getItem("github-token");r&&(this.token=r,this.githubSync=new bt(r)),Object(it.e)(function(){return localStorage.setItem("github-token",n.token)})}return Object(m.a)(e,[{key:"oauthSuccess",value:function(e){this.token=e,this.githubSync=new bt(e),this.sync()}}]),e}(),X=Object(at.a)($.prototype,"token",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Y=Object(at.a)($.prototype,"syncing",[it.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(at.a)($.prototype,"oauthSuccess",[it.d],Object.getOwnPropertyDescriptor($.prototype,"oauthSuccess"),$.prototype),$),Ot=new function e(){Object(d.a)(this,e),this.driverStore=void 0,this.searchStore=void 0,this.playlistStore=void 0,this.songlistStore=void 0,this.snackbarStore=void 0,this.playerStore=void 0,this.githubStore=void 0,this.driverStore=new ct(this),this.searchStore=new st(this),this.playlistStore=new lt(this),this.songlistStore=new ut(this),this.snackbarStore=new ht(this),this.playerStore=new pt(this),this.githubStore=new vt(this)};window.baiyezi_music_store=Ot;var jt=Object(p.createMuiTheme)({typography:{useNextVariants:!0},palette:{}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(function(){return a.a.createElement(h.a,Ot,a.a.createElement(s.a,{history:ee},a.a.createElement(c.a,null,a.a.createElement(l.a,{path:"/oauth/github",component:et}),a.a.createElement(p.MuiThemeProvider,{theme:jt},a.a.createElement(Ne,null,a.a.createElement(c.a,null,a.a.createElement(l.a,{path:"/search",component:We}),a.a.createElement(l.a,{path:"/playlist",component:$e}),a.a.createElement(l.a,{path:"/songlist/:title",component:He}),a.a.createElement(u.a,{path:"/",to:"/search"})))))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[5452,1,2]]]);
//# sourceMappingURL=main.4db9c7d1.chunk.js.map